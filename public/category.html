<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Category | Mabel Statement</title>
  <link rel="stylesheet" href="Styles.css">
  <style>
    body { font-family: sans-serif; padding: 2rem; }
    .product-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 2rem;
    }
    .product-card {
      position: relative;
      width: 100%;
      padding-top: 200%;
      /* adjust for aspect ratio */
      overflow: hidden;
    }
    .product-card:hover {
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .product-card img {
      width: 100%;
      height: 200px;
      object-fit: cover;
      border-radius: 8px;
    }
    h2.category-title {
      margin-bottom: 2rem;
      text-transform: capitalize;
    }
  </style>
</head>
<body>
  <h2 class="category-title">Loading...</h2>
  <div class="product-grid" id="productGrid"></div>

  <script>
const API_BASE = 'https://clothing-store-demo.onrender.com/api/products';
const params = new URLSearchParams(window.location.search);
const category = params.get('cat');
const searchTerm = params.get('search')?.toLowerCase() || '';
const titleEl = document.querySelector('.category-title');
const grid = document.getElementById('productGrid');

async function fetchCategoryProducts() {
  titleEl.textContent = category
    ? `Results for "${searchTerm}" in ${category}`
    : searchTerm
    ? `Results for "${searchTerm}"`
    : category
    ? category
    : 'All Products';

  try {
    const res = await fetch(API_BASE);
    const products = await res.json();
    if (!Array.isArray(products)) throw new Error('Invalid response');

    const filtered = products.filter(p => {
      const matchCategory = category
        ? p.category?.toLowerCase() === category.toLowerCase()
        : true;

      const matchSearch = searchTerm
        ? p.name?.toLowerCase().includes(searchTerm)
        : true;

      return matchCategory && matchSearch;
    });

    if (filtered.length === 0) {
      grid.innerHTML = '<p>No matching products found.</p>';
      return;
    }

    grid.innerHTML = '';
    filtered.forEach(p => {
      const card = document.createElement('div');
      card.className = 'product-card';
      card.innerHTML = `
        <img src="${p.imageUrl?.startsWith('/') ? p.imageUrl : '/uploads/' + p.imageUrl}" alt="${p.name}">
        <h3>${p.name}</h3>
        <p><strong>KES ${p.price?.toFixed(2)}</strong></p>
      `;
      grid.appendChild(card);
    });
  } catch (err) {
    console.error(err);
    grid.innerHTML = '<p>Error loading products.</p>';
  }
}

fetchCategoryProducts();
    
  </script>
</body>
</html>
